<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食味製研所</title>
    <style>
        /* Reset CSS */
        body, h1, h2, h3, p, ul, li {
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4eded; 
            color: #333;
            line-height: 1.6;
        }
		   
		header {
		background-image: url('https://res.klook.com/image/upload/fl_lossy.progressive,w_1280,h_854,c_fill,q_85/activities/tkqfwvtuzwzyl6fvutnz.jpg');
		background-size: cover;
		background-position: center;
		background-repeat: no-repeat;
		padding: 50px 0;
		text-align: center;
		background-color: rgba(0, 0, 0, 0.5);
			
		}

		header h1,
		header p {
			font-size: 48px; /* 調整字體大小 */
			margin-bottom: 10px;
			color: #fff;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		}

		header p {
			font-size: 24px; /* 調整字體大小 */
		}

		input[type="text"] {
			border: 1px solid #ccc;
			border-radius: 5px;
			padding: 10px;
			box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
			background-color: #f9f9f9;
		}
		select {
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
			background-color: #f9f9f9;
			color: #333;
		}

        /* Navigation Styles */
        nav {
            background-color: #d9a09a;
            padding: 20px 0;
            text-align: center;
			
        }
        nav ul {
            list-style: none;
            padding: 0;
            display: flex;
            justify-content: center; /* 將選項置中 */
            gap: 20px; /* 選項間隔 */
        }
        nav li {
            margin: 0;
            position: relative;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            padding: 10px 15px;
            font-size: 16px;
            transition: background-color 0.3s ease;
            border-radius: 5px;
        }
        nav a:hover {
            background-color: #d1a8a0; /* 滑鼠懸停時 */
        }

        /* Dropdown Menu Styles */
        nav ul li ul {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #d9a09a;
            border-radius: 5px;
            overflow: hidden;
        }
        nav ul li:hover ul {
            display: block;
        }
        nav ul li ul li {
            display: block;
            width: 100%;
        }
        nav ul li ul li a {
            padding: 10px;
            display: block;
        }

        /* Main Content Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        section {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        section h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        section p {
            font-size: 16px;
            margin-bottom: 15px;
        }
        /* Footer Styles */
        footer {
            background-color: #d9a09a; 
            color: #fff;
            text-align: center;
            padding: 15px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        footer p {
            font-size: 14px;
        }

        .popup_out {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;  /* Adjust width as necessary */
            max-height: 80%;  /* Limit the height to ensure it doesn't go off screen */
            background-color: #fff;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 5px;
            z-index: 9999;
            overflow-y: auto;  /* Enables vertical scrolling */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);  /* Optional: Adds shadow for better visibility */
        }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 5px;
            z-index: 9999;
        }
        
    
        /* 背景模糊效果 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            display: none;
        }

        
		
		.recipe-carousel {
			overflow: hidden;
			width: 100%;
		}

		.recipe-list {
			display: flex;
			transition: transform 0.5s ease;
		}

		.recipe {
			flex: 0 0 33.33%; /* 一次顯示三個食譜 */
			box-sizing: border-box;
			padding: 10px;
		}


        .recipe-content {
			padding: 10px;
			background-color: #f9f9f9;
			border-radius: 5px;
			display: flex;
			flex-direction: column;
			align-items: center; /* 水平居中 */
			text-align: center; /* 文本水平居中 */
		}

        .recipe img {
            width: 80%;
            height: 80%;
            border-radius: 5px;
        }
        .recipe p {
            margin-top: 5px;
        }
        .recipe:hover p {
            font-weight: bold; /* 滑鼠懸停時文字變為粗體 */
        }
		/* Style for the submit button */
		button {
			display: block; /* 讓按鈕成為塊級元素以便居中 */
			width: 200px; /* 設置按鈕寬度 */
			padding: 15px; /* 增加內邊距 */
			margin: 20px auto; /* 上下間距20px，左右居中 */
			background-color: #d9a09a; /* 背景顏色 */
			color: #fff; /* 字體顏色 */
			font-size: 18px; /* 字體大小 */
			border: none; /* 去掉邊框 */
			border-radius: 5px; /* 圓角 */
			cursor: pointer; /* 滑鼠樣式 */
			transition: background-color 0.3s ease; /* 動畫效果 */
		}

		button:hover {
			background-color: #b88580; /* 滑鼠懸停時的背景顏色 */
		}

        section button {
            display: block; /* 讓按鈕成為塊級元素以便居中 */
			width: 100px; /* 設置按鈕寬度 */
			padding: 5px; /* 增加內邊距 */
			margin: 10px auto; /* 上下間距20px，左右居中 */
			background-color: #d9a09a; /* 背景顏色 */
			color: #fff; /* 字體顏色 */
			font-size: 12px; /* 字體大小 */
			border: none; /* 去掉邊框 */
			border-radius: 5px; /* 圓角 */
			cursor: pointer; /* 滑鼠樣式 */
			transition: background-color 0.3s ease; /* 動畫效果 */
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 2fr);
            gap: 10px;
            padding: 10px;
        }
        .article {
            border: 1px solid #ccc;
            padding: 10px;
        }
        .article img {
            width: 80%;
            height: 80%;
            border-radius: 5px;
        }
        #progress {
            width: 100%;
            background: #ccc;
            display:none;
        }
        #progress-bar {
            width: 0%;
            height: 20px;
            background-color: blue;
            text-align: center;
            color: white;
        }

    </style>
</head>
<body>
    <header>
        <h1>食味製研所</h1>
        <p>讓我們帶您發掘美味食譜的世界！</p>
    </header>
    <div id="nav-wrapper">
        <nav>
            <ul>
                <li><a href="#" id="back-to-top">首頁</a></li>
                <li><a href="#select-function">選擇功能</a>
                    <ul>
						<li><a href="#recipe-type">搜尋類別</a></li>
                        <li><a href="#age-group">個人化</a></li>                    
                    </ul>
                </li>
				   <li><a href="#popular-recipes">熱門食譜</a></li>
            </ul>
        </nav>
    </div>
    <div class="container">
        <section id="about-us">
            <h2>關於我們</h2>
            <p>食味製研所是一個能夠辨識食物並提供客製化推薦食譜的網站。</p>
            <p>您只需要上傳食物圖片，我們會幫助您找到最適合您的美味食譜！</p>
        </section>


        <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data">
            <section id="recipe-type">
                <h2>上傳圖片</h2>	
                <div class="imageOption">
                    <input type="file" name="imageUploadInput" accept="image/*">
                </div>
                                
                <h4>食譜種類</h4>
                <select name="timingOption">
                    <option value="nooption">*選填*</option>
                    <option value="Breakfast">早餐和早午餐</option>
                    <option value="Lunch">午餐</option>
                    <option value="Appetizers">開胃菜和小吃</option>
                    <option value="dinner">晚餐</option>
                    <option value="Dessert">甜點</option>
                    <option value="Drink">飲品</option>
                    <option value="Grilling">燒烤料理</option>
                    <option value="Easy">快速簡便食譜</option>
                    <option value="Baking">烘焙</option>
                </select>
                <h4>料理風味</h4>
                <select name="typeOption">
                    <option value="nooption">*選填*</option>
                    <option value="vegetarian">素食料理</option>
                    <option value="thai">泰式料理</option>
                    <option value="korean">韓式料理</option>
                    <option value="japanese">日式料理</option>
                    <option value="chinese">中式料理</option>
                    <option value="french">法式料理</option>
                    <option value="italian">義式料理</option>
                </select>
            </section>
            <section id="age-group">
                <h2>個人化（非必填）</h2>
                <h4>性別</h4>
                <select name="genderSelectOption">
                    <option value="male">男</option>
                    <option value="female">女</option>
                    <option value="neutral">不回答</option>
                </select>
                
                <h4>身高</h4>
                <input type="text" name="height" placeholder="請輸入身高" required>
                
                <h4>體重</h4>
                <input type="text" name="weight" placeholder="請輸入體重" required>
                
                <h4>體指率</h4>
                <input type="text" name="fat" placeholder="請輸入體指率" required>

                <h4>年齡</h4>
                <input type="text" name="age" placeholder="請輸入年齡" required>
            </section>
        
            <div style="text-align: center;">
                <button type="submit">提交</button>
            </div>
        </form>
        
        <p>Recognized: <span id="recognized"></span></p>
        <p>Prediction: <span id="prediction"></span></p>

        <section id="popular-recipes">
            <h2>熱門食譜</h2>
            <div class="recipe-carousel">
                <div class="recipe-list">
                    <div class="recipe">
                        <div class="recipe-content" onclick="openPopup()">
                            <img src="https://d3l76hx23vw40a.cloudfront.net/recipe/gy63-041.jpg" alt="奶油焗龍蝦">
                            <p>焗烤奶油龍蝦</p>
                        </div>
                    </div>
                    <div class="recipe">
                        <div class="recipe-content" onclick="openPopup()">
                            <img src="https://d3l76hx23vw40a.cloudfront.net/recipe/webp/gy63-012.webp" alt="紹興醉雞">
                            <p>紹興醉雞</p>
                        </div>
                    </div>
                    <div class="recipe">
                        <div class="recipe-content" onclick="openPopup()">
                            <img src="https://d3l76hx23vw40a.cloudfront.net/recipe/webp/gy63-013.webp" alt="客家鹹豬肉">
                            <p>客家鹹豬肉</p>
                        </div>
                    </div>
                    <div class="recipe">
                        <div class="recipe-content" onclick="openPopup()">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTeHocM_yXR-ePAm_RNqg-FMiwM2mdbPFvL_40c-IZvrQ&s" alt="巧克力蛋糕">
                            <p>巧克力蛋糕</p>
                        </div>
                    </div>
                    <div class="recipe">
                        <div class="recipe-content" onclick="openPopup()">
                            <img src="https://www.thermos.com.tw/Upload/RECICONT/294/%E9%A6%99%E7%85%8E%E9%AE%AD%E9%AD%9A%E4%BD%90%E5%A4%A7%E8%92%9C%E5%A5%B6%E6%B2%B9%E6%AA%B8%E6%AA%AC.jpg" alt="烤鮭魚佐檸檬醬">
                            <p>烤鮭魚佐檸檬醬</p>
                        </div>
                    </div>
                    <div class="recipe">
                        <div class="recipe-content" onclick="openPopup()">
                            <img src="https://tokyo-kitchen.icook.network/uploads/recipe/cover/267919/7aa4779ce5040c2a.jpg" alt="墨西哥玉米餅塔可">
                            <p>墨西哥玉米餅塔可</p>
                        </div>
                    </div>
                </div>
            </div>
	    </section>
    <div class="overlay" id="overlay"></div>
    <div class="popup_out" id="popup_out">
        {% for article in articles %}
            <div class="article" >
                <p>{{ article.ingredients }}</p>                  
            </div>      
            <h2>食譜標題</h2>
            <p>做法、熱量之類的</p>
            <button onclick="closePopup({{article.id}})">關閉視窗</button>
            {% endfor %}
    </div>
    <div id="progress" display="block">
        <div id="progress-bar">0%</div>
    </div>
    <button onclick="refreshArticles()">刷新文章</button>
    <section>
        <div class="recipe-carousel">
            <div class="recipe-list">
                <div class="grid-container">
                    {% for article in articles %}
                        <div class="article" >
                            <img src="{{ article.pics }}" alt="Article Image">
                            <p>{{ article.text }}</p>
                            <button onclick="openPopup({{ article.id }})">查看食譜</button>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
    <br>
    <br>
</body>

<footer>
    <p>ChefChatter 食味製研所</p>
</footer>

    <script>

        function updateData() {
            fetch('/upload').then(response => {
                return response.json();
            }).then(data => {
                console.log(data); 
                document.getElementById('recognized').innerText = data.recognized;
                document.getElementById('prediction').innerText = data.prediction;
            }).catch(error => {
                console.error('Error:', error);
            });
        }

        document.getElementById('uploadForm').addEventListener('submit', function(event){
            event.preventDefault();  // 阻止表单默认提交
            updateData();  // 调用更新数据的函数
        });

        
        // 讀取圖片
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            event.preventDefault();  // 阻止表单默认提交

            var formData = new FormData(this);  // 创建 FormData 对象

            fetch('/upload', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);  // 输出返回的数据
                document.getElementById('recognized').innerText = data.recognized;
                document.getElementById('prediction').innerText = data.prediction;
            })
            .catch(error => console.error('Error:', error));
        });


        function submitData() {
            const foodInputEl = document.getElementById('textInput');
            if (foodInputEl) {
                const foodInput = foodInputEl.value;

            } else {
                console.log('textInput element not found');
            }
            const heightInputEl = document.getElementById('height');
            const weightInputEl = document.getElementById('weight');

            if (heightInputEl && weightInputEl) {
                const heightInput = heightInputEl.value;
                const weightInput = weightInputEl.value;
                console.log(`Height: ${heightInput}, Weight: ${weightInput}`);
                // 根据获取的数据执行后续操作
            } else {
                console.log('Height and/or Weight input element not found');
            }
        }

        function op_submitData() {
            // 獲取年齡下拉式選單的值
            const ageSelectElement = document.getElementById('ageSelectOption');
            const ageSelectedValue = ageSelectElement.value;
            const genderSelectElement = document.getElementById('genderSelectOption');
            const genderSelectValue = genderSelectElement.value;
            const timingOptionElement = document.getElementById('timingOption');
            const timingOptionValue = timingOptionElement.value;
            const typeOptionElement = document.getElementById('typeOption');
            const typeOptionValue = typeOptionElement.value;

            // 在輸出區域顯示選擇的值
            //const outputop = document.getElementById('op_output');
            //op_output.innerText = "你選擇的值是：" + selectedValue;
        }

        function refreshArticles() {
            document.getElementById("progress").style.display = "block";
            var progressBar = document.getElementById('progress-bar');
            progressBar.style.width = '0%';  // Reset progress bar
            progressBar.textContent = '0%';  // Reset text
            var interval = 210;  // Interval in ms
            var width = 0;
        
            var timer = setInterval(function() {
                width++;
                progressBar.style.width = width + '%';
                progressBar.textContent = width + '%';
                if (width >= 100) {
                    clearInterval(timer);
                }
            }, 300);  // Update the progress bar every 300ms, which totals roughly 30 seconds to reach 100%
        
            fetch('/refresh', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    const container = document.querySelector('.grid-container');
                    container.innerHTML = '';
                    const container_pop = document.querySelector('.popup_out');
                    container_pop.innerHTML = '';
                    data.forEach((article, index) => {
                        const articleDiv1 = document.createElement('div');
                        const articleDiv2 = document.createElement('div');
                        article.id = index;
                        articleDiv1.className = 'recipe';
                        articleDiv2.className = 'recipe-content';
                        articleDiv2.innerHTML = `
                            <img src="${article.img}" alt="Article Image">
                            <p>${article.text}</p>
                            <button onclick="openPopup(${article.id})">查看食譜</button>`;
                        container.appendChild(articleDiv1);
                        articleDiv1.appendChild(articleDiv2);
        
                        const articlepopDiv = document.createElement('div');
                        articlepopDiv.className = 'popup';
                        articlepopDiv.id = `popup-${index}`;
                        articlepopDiv.innerHTML = `<p>${article.ingredients.join(', ')}</p><button onclick="closePopup('popup-${index}')">關閉視窗</button>`;
                        container_pop.appendChild(articlepopDiv); 
                    });
                    
                    clearInterval(timer);  // Stop the timer when data is received
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    document.getElementById("progress").style.display = "none";
                });
        }
        
        function openPopup(articleId) {
            console.log("Article ID received in openPopup:", articleId);  // 調試用
            const popup_out = document.getElementById("popup_out");
            const overlay = document.getElementById("overlay");
        
            fetch(`/getRecipe?articleId=${articleId}`)
                .then(response => response.json())
                .then(recipe => {
                    if (recipe.error) {
                        console.error('Error fetching recipe:', recipe.error);
                        return;
                    }
        
                    // Ensure that ingredients are in an array format
                    const ingredients = Array.isArray(recipe.ingredients) ? recipe.ingredients : recipe.ingredients ? [recipe.ingredients] : [];
        
                    // Proceed with creating HTML elements
                    let ingredientsHTML = `<h3>Ingredients</h3><ul>${ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}</ul>`;
                    let directionsHTML = `<h3>Directions</h3><ul>${recipe.directions.map(step => `<li>${step}</li>`).join('')}</ul>`;
                    let nutritionHTML = `<h3>Nutrition</h3><ul>${recipe.nutrition.map(nutrient => `<li>${nutrient}</li>`).join('')}</ul>`;
        
                    popup_out.innerHTML = ''; // Clear current popup content
                    const articleDiv = document.createElement('div');
                    articleDiv.className = 'article';
                    articleDiv.innerHTML = `
                        <h2>${recipe.text}</h2>
                        <img src="${recipe.img}" alt="Recipe Image" style="width:100%; max-height:300px; object-fit:contain;">
                        ${ingredientsHTML}
                        ${directionsHTML}
                        ${nutritionHTML}
                        <button onclick="closePopup('popup_out')">關閉視窗</button>`;
        
                    popup_out.appendChild(articleDiv);
        
                    // Display popup and overlay
                    popup_out.style.display = "block";
                    overlay.style.display = "block";
                })
                .catch(error => {
                    console.error('Error fetching recipe:', error);
                });
        }
        
        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            const overlay = document.getElementById("overlay");
            if (popup) {
                popup.style.display = "none";
            }
            if (overlay) {
                overlay.style.display = "none";
            }
        }

		
    let currentIndex = 0;
    const recipes = document.querySelectorAll('.recipe');
    const totalRecipes = recipes.length;

    function showNextRecipe() {
        currentIndex++;
        const recipeList = document.querySelector('.recipe-list');

        // 使用 translateX 实现动画效果
        recipeList.style.transition = 'transform 0.5s ease';
        recipeList.style.transform = `translateX(-${(currentIndex * 100) / 3}%)`;

        // 在动画结束后，将第一个食谱移到最后，并重置 transform
        setTimeout(() => {
            recipeList.style.transition = 'none';
            recipeList.appendChild(recipeList.firstElementChild);
            currentIndex--;
            recipeList.style.transform = `translateX(-${(currentIndex * 100) / 3}%)`;
        }, 500);
    }

    setInterval(showNextRecipe, 2500); // 每3秒切換一次
    

    </script>
</body>
</html>
